<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>回放_定位</title>
  <link href="css/base.css" rel="stylesheet" type="text/css"/>
  <style type="text/css">
    body {
      margin: 0;
      padding: 0;
    }

    ul, li {
      margin: 0;
      padding: 0;
      list-style: none;
    }
  </style>
  <script src="js/common.js"></script>
  <!--script>    alert("区域码=" + Utility.getSystemInfo("ARC") + "\n    rtsp=" + decodeURIComponent(getGlobalVar("vod_ctrl_rtsp")));</script-->
  <script src="js/countControl.js"></script>
  <script src="js/timeControl.js"></script>
  <script src="js/voices.js"></script>
  <script src="js/main.js"></script>
  <script>
    Utility.setDrawFocusRing(0);
    var mp = new MediaPlayer();
    var timeControl;
    var rtsp;
    var voice;
    var backurl;
    var currentStatus = -1;
    var speedAction = 0; //check out whether fast move, 1:fast move forward;-1:fast move rewind
    var delaytimer;
    var seconds = 0;
    var isZeroDuration = false;
    var isTCTimerExist = false;
    var checkTimer;
    var isShowPosition = 0;
    var needResetTimeControl = true;
    var speed = 0;
    var videoEndTime = 0;
    var execCount = 0;
    var isInitOver = false;
    var isStop = true;
    var isMove = false;
    var fastTimer;
    var isFastTimerExist;
    var vod_play_type = getGlobalVar("vod_play_type"); //is only view a few seconds.
    var playTime_ByInterval = -1;


    function initPage() {
      setSmartCardId();
      rtsp = decodeURIComponent(getGlobalVar("vod_ctrl_rtsp"));
      if (rtsp == "") gotoHref(1, "100001");
      backurl = getGlobalVar("vod_ctrl_backurl");
      var list = rtsp.split("6126");
      setDisplay(false, false);
      setDisplay_loc(0);
      if (!isCancelQuit()) {
        playVideo(); //first play
      } else {
        var nativePlayerInstanceId = getGlobalVar("nativePlayerInstanceId");
        mp.bindNativePlayerInstance(nativePlayerInstanceId);
        var play_from_interval = getGlobalVar("play_from_interval");
        if (play_from_interval != null && play_from_interval != "") playTime_ByInterval = getIntValue(play_from_interval);
        if (playTime_ByInterval >= 0) {
          mp.stop();
          setGlobalVar("play_from_interval", "");
          playVideo();
        }
      }
      delaytimer = setTimeout("init()", 3000); // move to 768 event
    }
    function playVideo() {
      setGlobalVar("nativePlayerInstanceId", mp.getNativePlayerInstanceId());
      playVedioInit(rtsp); //first play
    }
    function checkTimerControl() {
      if (speedAction == 0)
        seconds++;
      if (needResetTimeControl) resetTimerControl();
      if (seconds > 10) {
        var showStatusImg = false;
        if (isPause()) showStatusImg = true;
        setDisplay(false, showStatusImg); // the status image still exist when status is pause.
      }
    }
    var startTimeOffset = 0;
    function getAllTime() {
      if (vod_play_type == "1") {
        var totalTime = getGlobalVar("vod_play_totalTime");
        if (totalTime != null && totalTime != "") videoEndTime = parseInt(totalTime, 10);
        else videoEndTime = getIntValue(getQueryStr("endTime", rtsp));  // seconds
        startTimeOffset = getIntValue(getQueryStr("startTime", rtsp));
      } else
        videoEndTime = getIntValue(mp.getMediaDuration());  // seconds
      if (isNaN(videoEndTime)) videoEndTime = 0;
      if (!isNaN(videoEndTime)) getMoveParams();
      if (videoEndTime <= 0) isZeroDuration = true;
      else isZeroDuration = false;
    }
    function init() {
      var isFromCancel = isCancelQuit();
      getAllTime();
      var startTimeFromVedio = mp.getCurrentPlayTime(); //getIntValue(getQueryStr("startTime", rtsp));  // startTime's format is yyyymmddhhmmss from other program , but it is seconds from vod play
      if (startTimeFromVedio > videoEndTime) startTimeFromVedio = 0;
      initTimeControl(0, videoEndTime, startTimeFromVedio); //set time control
      initVoiceControl(); //set voice control
      $("play_program").innerText = decodeURIComponent(getGlobalVar("displayName"));
      setProgrammeInfo(convertToShowTime(videoEndTime)); //set other information
      if (isFromCancel) { //from other page return
        currentStatus = getIntValue(getQueryStr("currentStatus", LocString));
        initPlayTime = getIntValue(getQueryStr("initPlayTime", LocString));
        setStatusImg(currentStatus);
        resetTimerControl();
        if (getGlobalVar("vod_ctrl_isFastRewindBack") == "Y") {
          setTimeout("beginReplay(1)", 10);
          setGlobalVar("vod_ctrl_isFastRewindBack", "");
        }
      } else {
        setStatusImg(0); //set play status	
        execCount++;
        if (execCount >= 2) stopCount();
      }
      clearTimeout(delaytimer);
      isInitOver = true;
    }
    function initTimeControl(bTime, eTime, sTime) {
      timeControl = new TimeControl(265, 690);
      timeControl.init($("main"), bTime, eTime, parseInt(sTime, 10));
      setPlayTime(timeControl.showTime);
    }
    function initVoiceControl() {
      var defaultVoice = mp.getVolume();
      voice = new Voices(343, 600, 0);
      var realVoice = 0;
      if (!isNaN(defaultVoice)) realVoice = Math.round(parseInt(defaultVoice, 10) * voice.maxVoice / 100);
      voice.currentVoice = realVoice;
      voice.currentLen = voice.setVoiceLen(realVoice);
      voice.init($("dv_voice"));
    }
    function resetTimerControl() {//only set time control and play time display
      if (initPlayTime == -1) return;
      if (videoEndTime <= 0) {
        getAllTime();
        timeControl.resetEndTime(0, videoEndTime);
        setProgrammeInfo(convertToShowTime(videoEndTime));
      }
      var currentPT = mp.getCurrentPlayTime();
      if (isNaN(currentPT) || parseInt(currentPT, 10) < 0) { //this time always must be a plus int.
        //setGlobalVar("reasonCode", currentPT);
        //gotoHref(1, "100003");	
        return;
      }
      var disTimes = parseInt(currentPT, 10) - startTimeOffset;  //+ initPlayTime;
      timeControl.resetTC(Math.max(disTimes, 0));
      setPlayTime(timeControl.showTime);
      $("txtInput").focus();
    }
    function setTimerControl() {//show time control and reset time
      resetTimerControl();
      setDisplay(true, true);
    }
    function stopCount() {
      if (cControl != null) cControl.stopTimer();
      setDisplay(true, true);
    }
    /*************************** page init start *******************************/
    function setPlayTime(playTime) {
      $("play_time").innerText = playTime;
    }
    function setProgrammeInfo(eTime) {
      $("end_time").innerText = eTime;
    }
    function setStatusImg(status) {
      var src = getStatusImgSrc(status);
      var speedStr = "";
      if (status == 1) {
        needResetTimeControl = false;
        isMove = true;
        setPauseTimer(true);
      } else if (status == 3 || status == 4) {
        speedStr = speed + "X";
        isMove = true;
      }
      if (src != "") $("imgStatus").src = src;
      //    $("g_speed").innerText = speedStr; //remove speed show
      currentStatus = status;
    }
    function setDisplay(show, imgShow) {//set time control and status image display
      if (show) {
        displayTrack(0);
        voice.voiceDisplay(false);
        $("main").style.visibility = "visible";
      } else {
        $("main").style.visibility = "hidden";
      }
      if (imgShow) {
        $("g_button").style.visibility = "visible";
        $("g_speed").style.visibility = "visible";
      } else {
        $("g_button").style.visibility = "hidden";
        $("g_speed").style.visibility = "hidden";
      }
      if (show && imgShow && !isTCTimerExist) {
        checkTimer = setInterval("checkTimerControl();", 1000);
        isTCTimerExist = true;
      }
      if (!show && isTCTimerExist) {
        clearInterval(checkTimer);
        isTCTimerExist = false;
      }
    }
    /*************************** page init end *******************************/
//check time control whether show
    function getDisplay() {
      return ($("main").style.visibility != "hidden");
    }
    function isPause() {
      return (currentStatus == 1);
    }
    function isPlay() {
      return (currentStatus == 0);
    }
    /*************************** position control start *******************************/
//check position control if show
    function getDisplay_loc() {
      return ($("input_box").style.visibility != "hidden");
    }
    //set position control display, 1=show, 0=hidden
    function setDisplay_loc(isdisplay) {
      if (isdisplay == 1) {
        pSeconds = 0;
        $("input_box").style.visibility = "visible";
        setTimerControl();
        $("txtInput").focus();
        checkPos = setInterval("checkPosition()", 1000);
      } else {
        $("input_box").style.visibility = "hidden";
        $("txtInput").blur();
        setPostionTipDisplay(false, -1);
        isShowPosition = 0;
        clearInterval(checkPos);
      }
    }
    var pSeconds = 0;
    var checkPos;
    function checkPosition() {
      pSeconds++;
      if (pSeconds > 15) {
        setDisplay_loc(0);
        clearInterval(checkPos);
      }
    }
    function setPostionTipDisplay(isdisplay, type) {
      var str = getPostionStr(type);
      if (str != "") $("locationTip").innerText = str;
      if (isdisplay && getDisplay_loc()) $("locationTip").style.visibility = "visible";
      else $("locationTip").style.visibility = "hidden";
    }
    /*************************** media play start *******************************/
    var initPlayTime = -1;
    function playVedioInit(mediaStr) {
      //  var areaCode = Utility.getSystemInfo("ARC"); // for test 1
      var areaCode = Utility.getSystemInfo("ARC");
      if (areaCode == null || areaCode == "" || isNaN(areaCode) || parseInt(areaCode, 10) < 0) {
        setGlobalVar("reasonCode", areaCode);
        gotoHref(1, "100005");
      }
      mediaStr = mediaStr.replaceQueryStr(areaCode, "areaCode");
      initPlayTime = 0; //getIntValue(getQueryStr("startTime", rtsp));
      mp.setAllowTrickmodeFlag(0);
      mp.setSingleMedia(mediaStr);
      mp.setCurrentAudioChannel("Stereo"); //set channel to Stereo when start
      mp.setVideoDisplayMode(1);
      mp.refreshVideoDisplay();
      mp.playFromStart();
    }
    function mpPlay() {//playTime : second
      if (speedAction != 0) mp.resume();     //fast move resume
      else {
        var timeDis = timeControl.currentTimes + startTimeOffset; // - initPlayTime ;
        mp.playByTime(1, timeDis + "", 0);
      }
    }
    /************************* voice start *******************************/
    function doVoice(val, e) {
      e.preventDefault();
      if ($("g_static").style.visibility != "hidden" && val == KEY_VOICEDOWN) resetStatic(0);
      if (val == KEY_VOICEUP || val == REWIND_KEY) type = -1;
      else type = 1;
      voice.voiceSeconds = 0;
      voice.voiceDisplay(true);
      voice.UpDown(type);
      mp.setVolume(Math.round(100 * voice.currentVoice / voice.maxVoice));
    }
    function checkVoiceControl() {
      voice.voiceSeconds++;
      if (voice.voiceSeconds > 5) voice.voiceDisplay(false);
    }
    /************************* action start ********************************/
    function move(type) {
      timeControl.UpDown(type);
      setPlayTime(timeControl.showTime);
    }
    function fastmove(val) {
      setDisplay(true, true); // the time control is show when fast move
      if ((speed >= maxSpeed || isTopWay) && val == FAST_FORWARD_KEY && speedAction == 1) return;
      else if ((speed >= maxSpeed || isTopWay) && val == FAST_REWIND_KEY && speedAction == -1) return;
      if ((val == FAST_FORWARD_KEY && speedAction == -1) || (val == FAST_REWIND_KEY && speedAction == 1)) speed = 0;
      if (speed == 0) speed = defaultSpeed; else speed *= 2;
      if (val == FAST_FORWARD_KEY) {
        speedAction = 1;
        setStatusImg(3);
        mp.fastForward(speed);
      } else {
        speedAction = -1;
        setStatusImg(4);
        mp.fastRewind(-speed);
        if (speedAction != 0 && !isFastTimerExist && startTimeOffset != 0) { //random preplay need to know current play time
          fastTimer = setInterval("checkFastRewind();", 1000);
          isFastTimerExist = true;
        }
      }
    }
    function checkFastRewind() {
      var currentPT = mp.getCurrentPlayTime();
      if (isNaN(currentPT) || parseInt(currentPT, 10) < 0 || currentStatus != 4) {
        stopfastTimer();
        return;
      }
      var disTimes = parseInt(currentPT, 10) - startTimeOffset;
      if (disTimes <= 0) {
        stopfastTimer();
        beginReplay(0);
      }
    }
    function stopfastTimer() {
      clearInterval(fastTimer);
      isFastTimerExist = false;
    }
    function enterAction(val) {
      if (getDisplay_loc()) {
        var txtTime = $("txtInput").value.trim();
        if (txtTime == "" || txtTime == null) {
          setDisplay_loc(0);
          return;
        }
        if (isNaN(txtTime)) {
          setPostionTipDisplay(true, 1);
          return;
        }
        var time = getIntValue(txtTime) * 60;
        if (time - timeControl.allTimes > 0 && videoEndTime - time >= 0) {
          setPostionTipDisplay(true, 2);
        } else if (time > videoEndTime) {
          setPostionTipDisplay(true, 0);
        } else {
          timeControl.resetTC(time);
          setPlayTime(timeControl.showTime);
          setDisplay_loc(0);
          mpPlay();
          setStatusImg(0);
        }
        $("txtInput").focus();
      }
      else if (!getDisplay() && isPlay()) {	//when time control not display and in play status, show time control
        if (speedAction != 0) {
          mp.resume();
          setStatusImg(0);
        }
        setTimerControl();
      } else { //when time control display or not in play status, display and reset time control
        setDisplay(false, false);
        if (isPause()) {
          if (val == PLAY_KEY) mp.resume();
          else mpPlay();
        } else {
          if (isMove) mpPlay(); //play by the time of user choice
        }
        isMove = false;
        setStatusImg(0);
      }
    }
    var trackSeconds = 0;
    var trackTimeout;
    function resetTrack() {
      if (!isPlay()) return; // when is play status
      trackSeconds = 0;
      setDisplay(false, false); // the time control hidden and the status image hidden
      var obj = $("g_track");
      if (obj.style.visibility != "hidden") {
        mp.switchAudioChannel();
      } else {
        obj.style.visibility = "visible";
        if (trackTimeout != null) clearInterval(trackTimeout);
        trackTimeout = setInterval("countTrack()", 1000);
      }
      var trackStr = mp.getCurrentAudioChannel();
      obj.innerText = getTrackStr(trackStr);
    }
    function countTrack() {
      if (trackSeconds > 5) {
        trackSeconds = 0;
        $("g_track").style.visibility = "hidden";
        clearInterval(trackTimeout);
      } else {
        trackSeconds++;
      }
    }

    function displayTrack(isPlay) {
      if (isPlay != 0 && _currentDisplayMode != 0 && _currentDisplayMode != isPlay) {
        removeTrack();
      }
      if (isPlay == 1) resetTrack();
      else if (isPlay == 2) resetScreenMatchMode();
      else removeTrack();
      _currentDisplayMode = isPlay;
    }
    function removeTrack() {
      trackSeconds = 6;
      countTrack();
    }
    var _currentMatchMode = 0;
    var _currentDisplayMode = 0;
    function resetScreenMatchMode() {//setScreenMatchMode
      trackSeconds = 0;
      setDisplay(false, false); // the time control hidden and the status image hidden
      var obj = $("g_track");
      if (obj.style.visibility != "hidden") {
        _currentMatchMode = ++_currentMatchMode % 3;
        mp.setMatchMode(_currentMatchMode);
      } else {
        obj.style.visibility = "visible";
        if (trackTimeout != null) clearInterval(trackTimeout);
        trackTimeout = setInterval("countTrack()", 1000);
      }
      _currentMatchMode = parseInt(mp.getMatchMode(), 10);
      obj.innerText = getMatchModeStr(_currentMatchMode);
    }
    function initStatic() {//static
      var obj = $("g_static");
      var muteFlag = parseInt(mp.getMuteFlag(), 10);
      if (muteFlag == 1) obj.style.visibility = "visible"; // static
      else obj.style.visibility = "hidden"; // voice
    }
    function resetStatic(muteFlag) {
      if (muteFlag == null) {
        muteFlag = parseInt(mp.getMuteFlag(), 10);
        muteFlag = (++muteFlag) % 2;
      }
      mp.setMuteFlag(muteFlag);
      initStatic();
    }
    function getEndPlayTimeParmeter() {//getEndPlayTimeParmeter
      var cPlayTime = mp.getCurrentPlayTime();
      var endPlayTime = initPlayTime; //getIntValue(getQueryStr("startTime", rtsp));
      if (!isNaN(cPlayTime)) endPlayTime += parseInt(cPlayTime, 10);
      if (videoEndTime == 0) getAllTime(); //maybe = 0 when quickly click keys from othe page return
      //if (timeControl.allTimes - endPlayTime >= 300) // for test 2 //no break point return when end play time less than 5 minutes to the end.
      return "&endPlayTime=" + endPlayTime;
      return "";
    }
    var perStepLen = 0;      //per step len, default len
    var move_default = 10;
    var move_maxlen = -1;    //max len when continue press key, -1: no limit
    var move_count = 1;      //continue count
    var move_addLen = 0;
    function getPerMoveLen() {
      //move_addLen = 0; //(move_count - 1) * move_default;     //increase len when continue press key
      if (move_addLen == 0) return;
      if (move_maxlen > 0 && perStepLen >= move_maxlen) return;
      if (move_count > 1) perStepLen += move_addLen;
      else perStepLen = move_default;
      if (move_maxlen > 0 && perStepLen > move_maxlen) perStepLen = move_maxlen;
    }
    function getMoveParams() {
      move_default = Math.round(videoEndTime * 0.005);
      move_maxlen = Math.round(videoEndTime * 0.04);
      move_addLen = Math.round(videoEndTime * 0.02);
      perStepLen = move_default;
    }


    function grabDown(e) {
      if (!isInitOver) {
        e.preventDefault();
        return false;
      } // when init not over, every key doesn't work
      setPostionTipDisplay(false, -1);
      seconds = 0; // time control hidden seconds
      needResetTimeControl = true;
      var val = e.which || e.keyCode;
      if (val != FAST_FORWARD_KEY && val != FAST_REWIND_KEY) speed = 0;
      var type;
      switch (val) {
        case KEY_VOICEUP:
        case KEY_VOICEDOWN:
          //if (getDisplay_loc()) return; //can't move time controler when position appear
          setDisplay_loc(0);
          isMove = false;
          setDisplay(false, false); //set all to invisible when click on voice key +-
          //if (!getDisplay()){
          if (!voice.isVoiceDisplay()) {
            e.preventDefault();
            voice.voiceDisplay(true);
          } else {
            doVoice(val, e);
          }
          //}
          break;
        case FORWARD_KEY:
        case REWIND_KEY:
          if (isZeroDuration) return;
          if (getDisplay_loc()) return; //can't move time controler when position appear
          if (getDisplay()) {
            getPerMoveLen();
            needResetTimeControl = false;
            if (val == FORWARD_KEY) {
              type = perStepLen;
              //setStatusImg(5);
            } else {
              type = -perStepLen;
              //setStatusImg(6);
            }
            move(type);
            move_count++;
            isMove = true;
          } else {
            e.preventDefault();
            //doVoice(val, e);
            setTimerControl(); //09.11.09,  show time control when left or right key click
          }
          break;
        case FAST_FORWARD_KEY:
        case FAST_REWIND_KEY:
          if (isZeroDuration) return;
          fastmove(val);
          break;
        case PAUSE_KEY:
          setTimerControl();
          if (isZeroDuration) return;
          if (!isPause()) {
            //1.pause
            setStatusImg(1);
            mp.pause();
          } else {
            //2.resume
            setStatusImg(0);
            mp.resume();
            isMove = false;
          }
          break;
        case PLAY_KEY:
        case ENTER_KEY:
          if (voice.isVoiceDisplay()) voice.voiceDisplay(false);
          else {
            if (isZeroDuration) return;
            enterAction(val);
          }
          break;
        case KEY_POSITION:
          isShowPosition = ++isShowPosition % 2;
          setDisplay_loc(isShowPosition);
          break;
        case KEY_INFORMATION:
        case GREEN_KEY:
          if (getDisplay()) {
            isMove = false;
            setDisplay(false, false);
          }
          else setTimerControl();
          break;
        case KEY_TRACK:
          e.preventDefault();
          displayTrack(1);
          break;
        case KEY_STATIC:
          e.preventDefault();
          if (voice.isVoiceDisplay()) voice.voiceDisplay(false); // return; //can't set mute when voice is display
          resetStatic(null);
          break;
        case KEY_HOMEPAGE:
        case QUIT_KEY:
        case STOP_KEY:
        case RETURN_KEY:
          e.preventDefault();
          if (getDisplay() && (val == QUIT_KEY || val == RETURN_KEY)) { // when showed controler, close controler and resume play
            setDisplay_loc(0);
            isMove = false;
            setDisplay(false, false);
            return;
          }
          if (val == KEY_HOMEPAGE || val == QUIT_KEY) {
            gotoHref(0, "1");
            return;
          }
          var parameter = "2"; //"0";
          //if (val == RETURN_KEY) parameter = "2";
          gotoHref(0, parameter + getEndPlayTimeParmeter());
          break;
//		case KEY_LX://联想
//			var parameter = "2"; //"0";
//            gotoHref(2, parameter + getEndPlayTimeParmeter());
//			break;
//		case KEY_ZX://咨询
//			var parameter = "2"; //"0";
//            gotoHref(3, parameter + getEndPlayTimeParmeter());
//			break;
//		case KEY_WEDGET://widget—portal
//			var parameter = "2"; //"0";
//			gotoHref(4, parameter + getEndPlayTimeParmeter());
//			break;
        case KEY_LANGUAGE:
          e.preventDefault();
          break;
        case KEY_SCREENDISPLAY:
          e.preventDefault();
          displayTrack(2);
          break;
        default:
          break;
      }
      if (val != FAST_FORWARD_KEY && val != FAST_REWIND_KEY) speedAction = 0;
    } //end grabDown


    var alreadyCount = false;
    function grabPress(e) {
      var val = e.which || e.keyCode;
      switch (val) {
        case 768:
          var ev = Utility.getEvent();
          var errorCode = 0;
          var speedRate = 0;
          var json = jsonParse(ev);
          if (!isNaN(json.error_code)) errorCode = parseInt(json.error_code, 10);
          if (json.type.toUpperCase() == "EVENT_PLAYMODE_CHANGE" && json.new_play_mode == 3 && !isNaN(json.new_play_rate))
            speedRate = parseInt(json.new_play_rate, 10);
          switch (errorCode) {
            case 1: //link error
            case 28: //stop play
            case 31: //invalid program
            case 32: //signal lost
              setGlobalVar("reasonCode", json.reason_code);
              setGlobalVar("reasonType", json.type);
              gotoHref(1, errorCode);
              break;
            case 6: //videol success connect
            case 19: //videol success prepare
              $("imgProcess").style.visibility = "hidden";
              if (!alreadyCount) {
                execCount++;
                if (execCount >= 2) stopCount();
                alreadyCount = true;
              }
              if (playTime_ByInterval > 0) {
                mp.playByTime(1, playTime_ByInterval + "", 0);
                playTime_ByInterval = -1;
              }
              break;
            case 8: //play over
              gotoHref(1, "100000");
              break;
            case 20: // fast rewind to begin time;
              beginReplay(0);
              break;
          }
          if (speedRate != 0) speedRateRecall(speedRate);
          break;
        case DVB.EVT_TYPE_CA_ALARM: //Card message
          var evt = DVB.getEvent(DVB.EVT_TYPE_CA_ALARM);
          if (evt.msgSubType == 1) pulloutCA(); //Card out
          break;
        default:
          break;
      }
    }
    function beginReplay(isContinue) {
      if (isContinue == 1) {
        mp.playByTime(1, 1 + startTimeOffset, 0);
        isMove = false;
        setDisplay(false, false);
        speedAction = 0;
        speed = 0;
        setStatusImg(0);
      } else {
        setGlobalVar("vod_ctrl_isFastRewindBack", "Y");
        gotoHref(0, "200000");
      }
    }
    function gotoHref(isTip, parame) {
      isStop = false;
      if (initPlayTime == -1) initPlayTime = 0;
      switch (isTip) {
        case 0: //接收到用户操作信息，跳转到操作页面
          url = prefix + "vod_exit.html?initPlayTime=" + initPlayTime + "&currentStatus=" + currentStatus + "&tipType=" + parame;
          break;
        case 1://接收到浏览器异常信息，跳转到异常处理页面
          url = prefix + "check_out.html?initPlayTime=" + initPlayTime + "&currentStatus=" + currentStatus + "&errorCode=" + parame;
          break;
        case 2://节目关联信息
          url = prefix + "search.htm?initPlayTime=" + initPlayTime + "&currentStatus=" + currentStatus + "&errorCode=" + parame;
          break;
        case 3://咨询
          url = prefix + "zixun.htm?initPlayTime=" + initPlayTime + "&currentStatus=" + currentStatus + "&errorCode=" + parame;
          break;
        case 4://widget_portal
          url = prefix + "widget.htm?initPlayTime=" + initPlayTime + "&currentStatus=" + currentStatus + "&errorCode=" + parame;
          break;
      }
//    location.href = url;
      //重写跳转页面
      window.location.replace(backurl)
    }

    function speedRateRecall(speedRate) {
      if (speedRate == 0) return;
      speed = Math.abs(speedRate);
      if (speedRate < 0) {
        speedAction = -1;
        setStatusImg(4);
      }
      else if (speedRate > 0) {
        speedAction = 1;
        setStatusImg(3);
      }
    }

    function closeVideo() {
      if (isStop) mp.stop();
    }
    function pulloutCA() {
      mp.pause();
      gotoHref(0, "10000" + getEndPlayTimeParmeter());
    }
    var pauseMinute = 0;
    var VOD_MAX_PAUSE_TIME = getMaxPauseTime();
    function checkPauseMinute() {
      if (!isPause()) {
        setPauseTimer(false);
        return;
      }
      pauseMinute++;
      if (pauseMinute > VOD_MAX_PAUSE_TIME) {
        clearInterval(pauseTimer);
        gotoHref(0, "3" + getEndPlayTimeParmeter());
      }
    }
    function setPauseTimer(isCheck) {
      pauseMinute = 0;
      clearInterval(pauseTimer);
      if (isCheck) pauseTimer = setInterval("checkPauseMinute()", 1000);
    }
    document.onkeydown = grabDown;
    document.onkeypress = grabPress;
    document.onkeyup = function () {
      move_count = 1;
      perStepLen = move_default;
    }
    window.addEventListener("unload", closeVideo, false);
  </script>
</head>
<body onload="initPage();" bgColor="transparent">
<div id="g_static"
     style="visibility:hidden;background:url(images/static_bg.png) no-repeat;position:absolute;left:220px;top:80px;width:78px;height:64px;"></div>
<div id="g_track"
     style="visibility:hidden;background:url(images/track_bg.png) no-repeat;position:absolute;left:900px;top:63px;width:155px;height:62px;font-size:26px;line-height:62px;text-align:center;"></div>
<div id="g_button"><img id="imgStatus" src="images/button_q.png" width="76" height="75"/></div>
<div id="g_speed"></div>
<div id="input_box" style="visibility:hidden;">
  <div id="location_bg"><img src="images/l_position.png"/></div>
  <div id="location">
    <input id="txtInput" style="BACKGROUND-COLOR: Transparent; border:0px;width:100px;color:#fff;" type="text"
           value=""/>分
  </div>
  <div id="locationTip"
       style="visibility:hidden;position:absolute;left:730px;top:324px;color:red;font-size:26px;width:260px;">
    输入时间比总时间长。
  </div>
</div>
<div id="main">
  <!--end_定位时间-->
  <p
    style="position:absolute;left:100px;top:488px;background:url(images/g_bg_1.png) no-repeat;width:1037px;height:162px;"></p>
  <div id="live_p"></div>
  <div id="begin_time">00:00:00</div>
  <div id="end_time">00:00:00</div>
  <div id="play_time">00:00:00</div>
  <div id="play_program"></div>
</div>
<div id="dv_voice" style="display:none;">
</div>
</body>
</html>
